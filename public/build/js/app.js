let step=1;const start_step=1,final_step=4,reservation={id:"",name:"",date:"",time:"",services:[],products:[]};function startApp(){showSection(),tabs(),pagerButtons(),prevPage(),nextPage(),getAPIServices(),saveClientId(),saveClienName(),saveDate(),saveTime(),showSummary()}function showSection(){const e=document.querySelector(".show-section");e&&e.classList.remove("show-section");document.querySelector("#step-"+step).classList.add("show-section");const t=document.querySelector(".current-tab");t&&t.classList.remove("current-tab");document.querySelector(`[data-step="${step}"]`).classList.add("current-tab")}function tabs(){document.querySelectorAll(".tabs button").forEach(e=>{e.addEventListener("click",(function(e){step=parseInt(e.target.dataset.step),showSection(),pagerButtons()}))})}function pagerButtons(){const e=document.querySelector("#previous"),t=document.querySelector("#next");1===step?(e.classList.add("hide"),t.classList.remove("hide")):4===step?(e.classList.remove("hide"),t.classList.add("hide"),showSummary()):(e.classList.remove("hide"),t.classList.remove("hide")),5===step&&(e.classList.add("hide"),t.classList.add("hide")),3===step&&getAPIProducts(),showSection()}function prevPage(){document.querySelector("#previous").addEventListener("click",(function(){step<=1||(step--,pagerButtons())}))}function nextPage(){document.querySelector("#next").addEventListener("click",(function(){step>=4||(step++,pagerButtons())}))}async function getAPIServices(){try{const e="http://localhost:3000/api/services",t=await fetch(e);showServices(await t.json())}catch(e){console.log(e)}}async function getAPIProducts(){try{const e="http://localhost:3000/api/products",t=await fetch(e);showProducts(await t.json())}catch(e){console.log(e)}}function showProducts(e){document.querySelector("#products").textContent||e.forEach(e=>{const{id:t,name:n,price:s,description:c,image:o}=e,a=document.createElement("P");a.classList.add("product-name"),a.textContent=n;const r=document.createElement("IMG");r.src=o;const i=document.createElement("P");i.classList.add("product-price"),i.textContent="$"+s;const d=document.createElement("DIV");d.classList.add("product"),d.dataset.productId=t,d.onclick=function(){selectProduct(e)},d.appendChild(a),d.appendChild(r),d.appendChild(i),document.querySelector("#products").appendChild(d)})}function showServices(e){e.forEach(e=>{const{id:t,name:n,price:s,description:c}=e,o=document.createElement("P");o.classList.add("service-name"),o.textContent=n;const a=document.createElement("P");a.classList.add("service-price"),a.textContent="$"+s;const r=document.createElement("DIV");r.classList.add("service"),r.dataset.serviceId=t,r.onclick=function(){selectService(e)},r.appendChild(o),r.appendChild(a),document.querySelector("#services").appendChild(r)})}function selectProduct(e){const{id:t}=e,{products:n}=reservation,s=document.querySelector(`[data-product-id="${t}"]`);n.some(e=>e.id===t)?(reservation.products=n.filter(e=>e.id!==t),s.classList.remove("selected")):(reservation.products=[...n,e],s.classList.add("selected"))}function selectService(e){const{id:t}=e,{services:n}=reservation,s=document.querySelector(`[data-service-id="${t}"]`);n.some(e=>e.id===t)?(reservation.services=n.filter(e=>e.id!==t),s.classList.remove("selected")):(reservation.services=[...n,e],s.classList.add("selected"))}function saveClientId(){reservation.id=document.querySelector("#id").value}function saveClienName(){reservation.name=document.querySelector("#name").value}function saveDate(){document.querySelector("#date").addEventListener("input",(function(e){const t=new Date(e.target.value).getUTCDay();[1].includes(t)?(e.target.value="",showAlert("Los lunes no hay servicio","error",".form")):reservation.date=e.target.value}))}function saveTime(){document.querySelector("#time").addEventListener("input",(function(e){const t=e.target.value.split(":")[0];t<12||t>21?(e.target.value="",showAlert("No hay servicio a esa hora","error",".form")):reservation.time=e.target.value}))}function showAlert(e,t,n,s=!0){const c=document.querySelector(".alert");c&&c.remove();const o=document.createElement("DIV");o.textContent=e,o.classList.add("alert"),o.classList.add(t);document.querySelector(n).appendChild(o),s&&setTimeout(()=>{o.remove()},3e3)}function showSummary(){const e=document.querySelector(".content-sum");for(;e.firstChild;)e.removeChild(e.firstChild);if(Object.values(reservation).includes("")||0===reservation.services.length)showAlert("Debes agregar mínimo un servicio y/o llenar todos los datos","error","#step-4",!1);else{const t=document.createElement("H3");t.textContent="Información de la reservación",e.appendChild(t);const{name:n,date:s,time:c,services:o,products:a}=reservation,r=document.createElement("P");r.innerHTML="<span>Nombre:</span> "+n;const i=new Date(s),d=i.getUTCMonth(),l=i.getDate()+2,u=i.getFullYear(),p={weekday:"long",year:"numeric",month:"long",day:"numeric"},m=new Date(Date.UTC(u,d,l)).toLocaleDateString("es-MX",p),v=document.createElement("P");v.innerHTML="<span>Fecha:</span> "+m;const h=document.createElement("P");h.innerHTML="<span>Hora:</span> "+c,e.appendChild(r),e.appendChild(v),e.appendChild(h);const f=document.createElement("H3");f.textContent="Servicios seleccionados",e.appendChild(f),o.forEach(t=>{const{id:n,name:s,price:c,description:o}=t,a=document.createElement("DIV");a.classList.add("service-container");const r=document.createElement("P");r.textContent=s;const i=document.createElement("P");i.innerHTML="<span>Precio:</span> $"+c,a.appendChild(r),a.appendChild(i),e.appendChild(a)});const C=document.createElement("H3");C.textContent="Productos extra agregados",e.appendChild(C),a.forEach(t=>{const{id:n,name:s,price:c,description:o,image:a}=t,r=document.createElement("DIV");r.classList.add("product-container");const i=document.createElement("P");i.textContent=s;const d=document.createElement("P");d.innerHTML="<span>Precio:</span> $"+c,r.appendChild(i),r.appendChild(d),e.appendChild(r)});const L=document.createElement("DIV");L.classList.add("container-submit");const S=document.createElement("BUTTON");S.classList.add("boton"),S.textContent="Reservar",S.onclick=doReservation,L.appendChild(S),e.appendChild(L)}}async function doReservation(){const{id:e,date:t,time:n,services:s,products:c}=reservation,o=s.map(e=>e.id),a=c.map(e=>e.id),r=new FormData;r.append("userId",e),r.append("date",t),r.append("time",n),r.append("services",o),r.append("products",a);try{const e="http://localhost:3000/api/reservations",t=await fetch(e,{method:"POST",body:r});(await t.json()).result&&Swal.fire({icon:"success",title:"Reservación creada",text:"Has reservado una cita en La barbería ©"}).then(()=>{window.location.reload()})}catch(e){Swal.fire({icon:"error",title:"Hubo un error",text:"No se pudo hacer la reservación"})}}document.addEventListener("DOMContentLoaded",(function(){startApp()}));